<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>R√ºckmeldung</title>
  <style>
    :root {
      --bg: #1e1e2f;
      --text: white;
      --box: #2e2e3f;
      --input: #333;
      --feedback-bg: #444;
      --btn: #5865F2;
    }
    body.light {
      --bg: #f5f5f5;
      --text: #111;
      --box: #fff;
      --input: white;
      --feedback-bg: #eee;
      --btn: #0078d7;
    }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
      transition: background-color 0.3s, color 0.3s;
    }
    h1 {
      text-align: center;
    }
    .mitglied {
      background-color: var(--box);
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .feedback-liste {
      margin-top: 8px;
      font-size: 0.9em;
    }
    .feedback-item {
      background-color: var(--feedback-bg);
      padding: 6px;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    textarea {
      width: 100%;
      max-width: 500px;
      height: 100px;
      margin-top: 10px;
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      background-color: var(--input);
      color: var(--text);
      border: 1px solid #555;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background-color: var(--btn);
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
<h1>R√ºckmeldung geben</h1>
<div id="liste"></div>
<div id="feedback-bereich" style="display:none">
  <h2 id="ziel-nutzer"></h2>
  <textarea id="feedback" placeholder="Dein Feedback..."></textarea>
  <br>
  <button onclick="sendeFeedback()">Abschicken</button>
</div>
<script>
const webhook = "https://discord.com/api/webhooks/YOUR_WEBHOOK_URL";

const mitglieder = [
  { name: "MaxMuster", id: "123" },
  { name: "PolizeiBot", id: "456" },
  { name: "DienstHabend", id: "789" },
];

let zielID = "";

function ladeFeedbacks() {
  return JSON.parse(localStorage.getItem("feedbacks")) || {};
}

function zeigeMitglieder() {
  const feedbacks = ladeFeedbacks();
  document.getElementById("liste").innerHTML = "";
  mitglieder.forEach(m => {
    const div = document.createElement("div");
    div.className = "mitglied";
    const name = document.createElement("div");
    name.textContent = m.name;
    name.style.fontWeight = "bold";

    const feedbackDiv = document.createElement("div");
    feedbackDiv.className = "feedback-liste";
    const eintraege = feedbacks[m.id] || [];
    eintraege.forEach(e => {
      const f = document.createElement("div");
      f.className = "feedback-item";
      f.textContent = `"${e.text}" ‚Äì ${e.sender}`;
      feedbackDiv.appendChild(f);
    });

    div.onclick = () => {
      zielID = m.id;
      document.getElementById("ziel-nutzer").textContent = `Feedback f√ºr ${m.name}`;
      document.getElementById("feedback-bereich").style.display = "block";
    };

    div.appendChild(name);
    div.appendChild(feedbackDiv);
    document.getElementById("liste").appendChild(div);
  });
}

function sendeFeedback() {
  const text = document.getElementById("feedback").value.trim();
  const sender = localStorage.getItem("discordName") || "Unbekannt";
  if (!text) return alert("Bitte Feedback eingeben.");

  const all = ladeFeedbacks();
  all[zielID] = all[zielID] || [];
  all[zielID].push({ sender, text });
  localStorage.setItem("feedbacks", JSON.stringify(all));

  const data = {
    content: `üìù **Feedback von ${sender}** f√ºr <@${zielID}>:\n${text}`
  };
  fetch(webhook, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  }).then(r => {
    if (r.ok) {
      alert("Feedback gesendet!");
      document.getElementById("feedback").value = "";
      document.getElementById("feedback-bereich").style.display = "none";
      zeigeMitglieder();
    } else {
      alert("Fehler beim Senden.");
    }
  });
}

const theme = localStorage.getItem("theme");
if (theme === "light") document.body.classList.add("light");
zeigeMitglieder();
</script>
</body>
</html>
